<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SimulationRunner.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">craftingtool</a> &gt; <a href="index.source.html" class="el_package">com.jomi.Util</a> &gt; <span class="el_source">SimulationRunner.java</span></div><h1>SimulationRunner.java</h1><pre class="source lang-java linenums">package com.jomi.Util;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import com.jomi.Handlers.Init.project.Project;
import com.jomi.Handlers.Item.LoadedItem;
import com.jomi.GUI.simlatorParts.baseNode.NodeView;
import com.jomi.Handlers.Init.project.Node;

<span class="nc" id="L12">public class SimulationRunner {</span>

    /**
     * Entry point: returns ALL final items produced by all branches.
     */
    public static List&lt;LoadedItem&gt; run(Project project, Map&lt;String, NodeView&gt; nodeViews) {

        // 1. Find StartNode
<span class="nc" id="L20">        Node start = project.getNodes().stream()</span>
<span class="nc" id="L21">            .filter(n -&gt; &quot;start&quot;.equals(n.getType()))</span>
<span class="nc" id="L22">            .findFirst()</span>
<span class="nc" id="L23">            .orElseThrow(() -&gt; new RuntimeException(&quot;No StartNode found&quot;));</span>

        // 2. Begin recursive branching simulation
<span class="nc" id="L26">        return runFromNode(project, nodeViews, start, null);</span>
    }


    /**
     * Recursive branch executor.
     * Each outgoing connection becomes a new branch.
     * No merging — each branch produces its own final LoadedItem.
     */
    private static List&lt;LoadedItem&gt; runFromNode(
            Project project,
            Map&lt;String, NodeView&gt; nodeViews,
            Node node,
            LoadedItem item
    ) {
<span class="nc" id="L41">        NodeView view = nodeViews.get(node.getId());</span>
<span class="nc bnc" id="L42" title="All 2 branches missed.">        if (view == null) {</span>
<span class="nc" id="L43">            throw new RuntimeException(&quot;No NodeView found for node &quot; + node.getId());</span>
        }

        // Execute this node
<span class="nc" id="L47">        item = view.execute(item);</span>

        // Find all outgoing connections
<span class="nc" id="L50">        List&lt;Node&gt; nextNodes = getNextNodes(project, node);</span>

        // If no outgoing nodes → this is an EndNode
<span class="nc bnc" id="L53" title="All 2 branches missed.">        if (nextNodes.isEmpty()) {</span>
<span class="nc" id="L54">            return List.of(item);</span>
        }

        // Branch into all outgoing paths
<span class="nc" id="L58">        List&lt;LoadedItem&gt; results = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">        for (Node next : nextNodes) {</span>
            // Each branch gets its own copy of the item
<span class="nc" id="L61">            results.addAll(runFromNode(project, nodeViews, next, item.copy()));</span>
<span class="nc" id="L62">        }</span>

<span class="nc" id="L64">        return results;</span>
    }


    /**
     * Returns ALL nodes connected as outputs from the given node.
     */
    private static List&lt;Node&gt; getNextNodes(Project project, Node node) {
<span class="nc" id="L72">        return project.getConnections().stream()</span>
<span class="nc" id="L73">            .filter(c -&gt; c.getFromNodeId().equals(node.getId()))</span>
<span class="nc" id="L74">            .map(c -&gt; project.getNodes().stream()</span>
<span class="nc" id="L75">                .filter(n -&gt; n.getId().equals(c.getToNodeID()))</span>
<span class="nc" id="L76">                .findFirst()</span>
<span class="nc" id="L77">                .orElse(null))</span>
<span class="nc bnc" id="L78" title="All 2 branches missed.">            .filter(n -&gt; n != null)</span>
<span class="nc" id="L79">            .toList();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>